{
  "meta": {
    "projectName": "fat-controller",
    "lastUpdated": "2026-02-21",
    "totalFiles": 52,
    "description": "Smart file index with cross-references and quick navigation",
    "lineNumberPolicy": "Use globs or directories instead of file:line references."
  },
  "byPurpose": {
    "_comment": "Organize files by their functional purpose",
    "commandWorkflow": {
      "primary": [
        ".claude/commands/prd.md",
        ".claude/commands/TaskGen.md",
        ".claude/commands/execute.md",
        ".claude/commands/bugs.md"
      ],
      "support": [
        ".claude/commands/commit.md",
        ".claude/commands/update.md",
        ".claude/commands/feature.md",
        ".claude/commands/code-review.md",
        ".claude/commands/debate.md",
        ".claude/commands/drift-report.md",
        ".claude/commands/values-discovery.md",
        ".claude/commands/domain-values.md",
        ".claude/commands/outcomes.md",
        ".claude/commands/orchestrate.md",
        ".claude/commands/lead.md"
      ]
    },
    "agents": {
      "primary": [
        ".claude/agents/prd-writer.md",
        ".claude/agents/task-writer.md",
        ".claude/agents/update-memory-agent.md",
        ".claude/agents/code-review-agent.md",
        ".claude/agents/cto.md",
        ".claude/agents/pm.md",
        ".claude/agents/pl.md",
        ".claude/agents/project-lead.md",
        ".claude/agents/discovery.md"
      ],
      "support": [
        ".claude/agents/cto-technical-advisor.md",
        ".claude/agents/security-auditor.md",
        ".claude/agents/ui-ux-expert.md",
        ".claude/agents/debate-agent.md",
        ".claude/agents/prompt-architect.md"
      ]
    },
    "memorySystem": {
      "authoritative": [
        ".ai/ARCHITECTURE.json",
        ".ai/BUSINESS.json",
        ".ai/FILES.json",
        ".ai/PATTERNS.md",
        ".ai/OPS.md",
        ".ai/CONSTRAINTS.md",
        ".ai/DEPRECATIONS.md",
        ".ai/TECH_DEBT.md",
        ".ai/CHANGELOG.md"
      ],
      "routing": [".ai/QUICK.md"],
      "metadata": [
        ".ai/README.md",
        ".ai/TODO.md",
        ".ai/SPRINT_UPDATE.md"
      ],
      "structured": [
        ".ai/decisions/",
        ".ai/solutions/",
        ".ai/patterns/"
      ],
      "templates": [
        "templates/.ai/ARCHITECTURE.json",
        "templates/.ai/BUSINESS.json",
        "templates/.ai/FILES.json",
        "templates/.ai/PATTERNS.md",
        "templates/.ai/OPS.md",
        "templates/.ai/CONSTRAINTS.md",
        "templates/.ai/DEPRECATIONS.md",
        "templates/.ai/TECH_DEBT.md",
        "templates/.ai/QUICK.md",
        "templates/.ai/README.md",
        "templates/.ai/TODO.md",
        "templates/.ai/SPRINT_UPDATE.md",
        "templates/.ai/decisions/000-template.md",
        "templates/.ai/solutions/_template.yaml",
        "templates/.ai/patterns/_TEMPLATE.md",
        "templates/tasks/.gitkeep"
      ]
    },
    "codexIntegration": {
      "prompts": [".codex/prompts/code-review.md"]
    },
    "projectBootstrap": {
      "install": ["install.js", "package.json"],
      "templates": [
        "templates/.ai/*",
        "templates/tasks/.gitkeep",
        "templates/ROADMAP.md",
        "templates/CLAUDE.md"
      ]
    },
    "orchestration": {
      "orchestrator": ["orchestrator.py"],
      "modelStylesheet": ["model-stylesheet.yaml"],
      "agents": [".claude/agents/pm.md", ".claude/agents/pl.md", ".claude/agents/discovery.md", ".claude/agents/project-lead.md"],
      "stateFiles": ["tasks/ROADMAP.md", "tasks/OUTCOMES.md", "tasks/PROJECT_STATE.md", "tasks/DECISIONS.md"],
      "templates": ["templates/ROADMAP.md"],
      "commands": [".claude/commands/outcomes.md", ".claude/commands/orchestrate.md", ".claude/commands/lead.md"]
    }
  },
  "byLayer": {
    "_comment": "Organize files by architectural layer",
    "commands": {
      "files": [".claude/commands/"],
      "pattern": "Interactive commands with user Q&A"
    },
    "agents": {
      "files": [".claude/agents/"],
      "pattern": "Autonomous document generation agents"
    },
    "memory": {
      "files": [".ai/"],
      "pattern": "AI memory system (8 core files)"
    }
  },
  "dependencies": {
    "_comment": "Map file relationships and dependencies",
    ".claude/commands/prd.md": {
      "uses": [".ai/ARCHITECTURE.json", ".ai/BUSINESS.json", ".ai/FILES.json", ".ai/PATTERNS.md", ".claude/agents/cto.md"],
      "invokes": [".claude/agents/prd-writer.md"],
      "outputs": ["/tasks/prd-[name].md"],
      "captures": [".ai/decisions/*.md"]
    },
    ".claude/commands/TaskGen.md": {
      "uses": [".ai/ARCHITECTURE.json", ".ai/FILES.json", ".ai/PATTERNS.md"],
      "invokes": [".claude/agents/task-writer.md"],
      "inputs": ["/tasks/prd-[name].md"],
      "outputs": ["/tasks/tasks-[name].md"]
    },
    ".claude/commands/bugs.md": {
      "uses": [".ai/ARCHITECTURE.json", ".ai/FILES.json", ".ai/PATTERNS.md", ".ai/BUSINESS.json", ".claude/agents/cto.md"],
      "outputs": ["/tasks/tasks-[bug].md", "/tasks/prd-[bug].md"],
      "captures": [".ai/solutions/*.yaml"]
    },
    ".claude/commands/execute.md": {
      "uses": [".ai/PATTERNS.md", ".ai/FILES.json", ".ai/QUICK.md", ".claude/agents/cto.md"],
      "inputs": ["/tasks/tasks-[name].md"],
      "invokes": [".claude/agents/task-protocol.md", ".claude/agents/cto-technical-advisor.md"],
      "captures": [".ai/solutions/*.yaml", ".ai/decisions/*.md", ".ai/DEPRECATIONS.md"]
    },
    ".claude/agents/cto.md": {
      "uses": [".ai/QUICK.md", ".ai/ARCHITECTURE.json", ".ai/PATTERNS.md", ".ai/BUSINESS.json", ".ai/CONSTRAINTS.md"],
      "invokes": [],
      "outputs": ["Decision statements with rationale"],
      "usedBy": [".claude/commands/prd.md", ".claude/commands/bugs.md", ".claude/commands/feature.md", ".claude/commands/execute.md"]
    },
    ".claude/commands/update.md": {
      "uses": [".ai/QUICK.md"],
      "invokes": [".claude/agents/update-memory-agent.md"],
      "validates": [".codex/prompts/code-review.md"]
    },
    ".claude/commands/pull-fc.md": {
      "syncs": [".claude/commands/", ".claude/agents/", ".claude/skills/", "templates/.ai/", "templates/tasks/"],
      "excludes": [".ai/", ".claude/settings.local.json"]
    },
    ".claude/commands/debate.md": {
      "uses": [".ai/QUICK.md", ".ai/ARCHITECTURE.json", ".ai/PATTERNS.md"],
      "invokes": [".claude/agents/debate-agent.md"],
      "outputs": ["debates/{topic-slug}/brief.md", "debates/{topic-slug}/state.md", "debates/{topic-slug}/debate.md"],
      "externalTools": ["codex"]
    },
    ".claude/commands/code-review.md": {
      "invokes": [".claude/agents/code-review-agent.md"],
      "validates": [".codex/prompts/code-review.md"],
      "captures": [".ai/TECH_DEBT.md"],
      "modes": ["dual-model (default)", "codex-only (--codex-only flag)"],
      "parallelExecution": "Claude (Task tool) + Codex (Bash) spawn simultaneously",
      "tempFiles": ["/tmp/code-review-claude.json", "/tmp/code-review-codex.json", "/tmp/code-review-merged.json", "/tmp/tech-debt-additions.json"]
    },
    ".claude/agents/update-memory-agent.md": {
      "uses": [".ai/QUICK.md"],
      "updates": [".ai/ARCHITECTURE.json", ".ai/BUSINESS.json", ".ai/FILES.json", ".ai/PATTERNS.md", ".ai/OPS.md", ".ai/CONSTRAINTS.md", ".ai/DEPRECATIONS.md", ".ai/TECH_DEBT.md", ".ai/CHANGELOG.md"]
    },
    ".claude/agents/code-review-agent.md": {
      "captures": {
        "CRITICAL": "fix immediately",
        "HIGH": "fix immediately",
        "MEDIUM": "user triage → .ai/TECH_DEBT.md or auto-fix",
        "LOW": "user triage → .ai/TECH_DEBT.md or skip"
      },
      "jsonSchema": "Standardized output format for dual-model review",
      "fields": ["id", "severity", "category", "location", "issue", "why_matters", "evidence", "recommended_fix", "task_description", "source", "confidence"]
    },
    "orchestrator.py": {
      "invokes": [".claude/agents/pm.md", ".claude/agents/pl.md"],
      "reads": ["tasks/ROADMAP.md", "tasks/OUTCOMES.md", "~/.claude/VALUES.md"],
      "writes": ["tasks/ROADMAP.md", ".claude-orchestrator/orchestrator.log"],
      "signals": ["YAML blocks between ---ORCHESTRATOR_SIGNAL--- markers"],
      "gitOperations": ["branch creation (sprint/*)", "checkout", "merge --no-commit", "merge abort on conflict"]
    },
    ".claude/agents/pm.md": {
      "uses": ["~/.claude/VALUES.md", "tasks/OUTCOMES.md", "tasks/ROADMAP.md"],
      "outputs": ["tasks/ROADMAP.md", "tasks/prd-{sprint}.md", "YAML signals (next_task, parallel_tasks, completed, blocked, halt)"],
      "invokedBy": ["orchestrator.py"]
    },
    ".claude/agents/pl.md": {
      "uses": ["~/.claude/VALUES.md", "tasks/prd-{sprint}.md"],
      "invokes": [".claude/commands/TaskGen.md", ".claude/commands/execute.md"],
      "outputs": ["YAML signals (sprint_result with success/error)", "git commits on sprint/* branch"],
      "invokedBy": ["orchestrator.py"]
    },
    ".claude/commands/values-discovery.md": {
      "outputs": ["~/.claude/VALUES.md"],
      "usedBy": [".claude/agents/cto.md", ".claude/agents/pm.md", ".claude/agents/pl.md"]
    },
    ".claude/commands/domain-values.md": {
      "outputs": ["~/.claude/domains/{domain}.md"],
      "usedBy": [".claude/agents/cto.md", ".claude/agents/pm.md", ".claude/agents/pl.md"]
    },
    ".claude/commands/outcomes.md": {
      "outputs": ["tasks/OUTCOMES.md", "tasks/PROJECT_STATE.md", "tasks/DECISIONS.md"],
      "optionalOutputs": ["CLAUDE.md (Project Lead section)"],
      "references": ["~/.claude/agents/project-lead.md"],
      "invokes": [".claude/commands/orchestrate.md (optional)"]
    },
    ".claude/commands/orchestrate.md": {
      "uses": ["tasks/OUTCOMES.md", "~/.claude/VALUES.md (optional)"],
      "invokes": ["orchestrator.py"],
      "prerequisites": ["git repository", "tasks/OUTCOMES.md"],
      "tmuxSession": "orchestrator",
      "outputs": ["tasks/orchestrator.log"]
    },
    ".claude/commands/lead.md": {
      "loads": ["~/.claude/agents/project-lead.md"],
      "uses": ["tasks/OUTCOMES.md", "tasks/PROJECT_STATE.md", "tasks/DECISIONS.md", ".ai/QUICK.md"],
      "invokes": [".claude/commands/prd.md", ".claude/commands/TaskGen.md", ".claude/commands/execute.md"],
      "outputs": ["tasks/PROJECT_STATE.md", "tasks/DECISIONS.md"],
      "prerequisites": ["tasks/OUTCOMES.md", "~/.claude/agents/project-lead.md"]
    },
    ".claude/agents/project-lead.md": {
      "uses": ["~/.claude/VALUES.md", "tasks/OUTCOMES.md", "tasks/PROJECT_STATE.md", "tasks/DECISIONS.md"],
      "invokes": [".claude/commands/prd.md", ".claude/commands/TaskGen.md", ".claude/commands/execute.md", ".claude/agents/cto.md"],
      "outputs": ["tasks/PROJECT_STATE.md", "tasks/DECISIONS.md", "sprint deliverables"],
      "invokedBy": [".claude/commands/lead.md"]
    },
    ".claude/agents/discovery.md": {
      "uses": ["~/.claude/VALUES.md"],
      "outputs": ["tasks/{node-id}/CONTEXT.md", "YAML signal (done|blocked|error)"],
      "invokedBy": ["orchestrator.py (DiscoveryHandler)"],
      "modes": ["simple (quick approach assessment)", "complex (investigation + debate)"]
    },
    ".claude/agents/prompt-architect.md": {
      "uses": ["~/.claude/VALUES.md"],
      "outputs": ["Refined prompt artifacts"],
      "invokedBy": ["orchestrator.py", "manual invocation"]
    },
    "model-stylesheet.yaml": {
      "defines": ["Model classes: planning, implementation, implementation-complex, review, gate, content-draft, discovery, discovery-simple, research, default"],
      "specifies": ["provider, model, reasoning_effort, tool_profile, timeout per class"],
      "fallbackChains": "Each class has fallback array tried in order on provider failure",
      "readBy": ["orchestrator.py"]
    }
  },
  "keyInterfaces": {
    "_comment": "Document critical interfaces and contracts",
    "agentHandoff": {
      "description": "Context passed from commands to agents",
      "format": "YAML structure with FEATURE_NAME, PROBLEM, MUST_HAVE, etc.",
      "usedBy": [".claude/commands/prd.md", ".claude/commands/tasks.md"]
    }
  }
}
